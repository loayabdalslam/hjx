import{_ as e,o as a,c as n,ag as i}from"./chunks/framework.ePeAWSvT.js";const u=JSON.parse('{"title":"Server-Driven Mode","description":"","frontmatter":{},"headers":[],"relativePath":"guide/server-driven.md","filePath":"guide/server-driven.md"}'),t={name:"guide/server-driven.md"};function l(r,s,p,h,d,o){return a(),n("div",null,[...s[0]||(s[0]=[i(`<h1 id="server-driven-mode" tabindex="-1">Server-Driven Mode <a class="header-anchor" href="#server-driven-mode" aria-label="Permalink to &quot;Server-Driven Mode&quot;">​</a></h1><p>HJX supports a server-driven mode where the server manages state and sends updates to the client via WebSocket.</p><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p>In server-driven mode:</p><ul><li>State lives on the server</li><li>Events are sent to the server via WebSocket</li><li>Server responds with state updates</li><li>Client automatically re-renders</li></ul><h2 id="when-to-use" tabindex="-1">When to Use <a class="header-anchor" href="#when-to-use" aria-label="Permalink to &quot;When to Use&quot;">​</a></h2><ul><li>Complex state logic that should stay on the server</li><li>Real-time applications with shared state</li><li>Applications requiring server-side validation</li><li>When you want centralized state management</li></ul><h2 id="running-in-server-driven-mode" tabindex="-1">Running in Server-Driven Mode <a class="header-anchor" href="#running-in-server-driven-mode" aria-label="Permalink to &quot;Running in Server-Driven Mode&quot;">​</a></h2><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dist/cli.js</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> examples/counter.hjx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dist-app</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5172</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>The dev server automatically enables WebSocket communication.</p><h2 id="architecture" tabindex="-1">Architecture <a class="header-anchor" href="#architecture" aria-label="Permalink to &quot;Architecture&quot;">​</a></h2><h3 id="client-side" tabindex="-1">Client Side <a class="header-anchor" href="#client-side" aria-label="Permalink to &quot;Client Side&quot;">​</a></h3><p>The client connects to the server via WebSocket:</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ws</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> WebSocket</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ws://localhost:5172/hjx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Messages are JSON:</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Client sends:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{ </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;event&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">handler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;increment&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [] }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Server responds:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{ </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;update&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">state</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="server-side" tabindex="-1">Server Side <a class="header-anchor" href="#server-side" aria-label="Permalink to &quot;Server Side&quot;">​</a></h3><p>The server (<code>server_session.ts</code>) manages component state:</p><ul><li>Parses the HJX component</li><li>Maintains state in memory</li><li>Handles events by executing handlers</li><li>Broadcasts updates to connected clients</li></ul><h2 id="state-synchronization" tabindex="-1">State Synchronization <a class="header-anchor" href="#state-synchronization" aria-label="Permalink to &quot;State Synchronization&quot;">​</a></h2><ol><li>Initial load: Server sends full state</li><li>Event: Client sends event to server</li><li>Processing: Server executes handler</li><li>Update: Server sends new state to all clients</li><li>Render: Client updates UI</li></ol><h2 id="example" tabindex="-1">Example <a class="header-anchor" href="#example" aria-label="Permalink to &quot;Example&quot;">​</a></h2><div class="language-hjx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">hjx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>component Counter</span></span>
<span class="line"><span></span></span>
<span class="line"><span>state:</span></span>
<span class="line"><span>  count = 0</span></span>
<span class="line"><span></span></span>
<span class="line"><span>layout:</span></span>
<span class="line"><span>  view:</span></span>
<span class="line"><span>    text: &quot;Count: {{count}}&quot;</span></span>
<span class="line"><span>    button (on click -&gt; increment): &quot;+&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>handlers:</span></span>
<span class="line"><span>  increment:</span></span>
<span class="line"><span>    set count = count + 1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>In server-driven mode, when the user clicks the button:</p><ol><li>Client sends <code>{ type: &quot;event&quot;, handler: &quot;increment&quot; }</code></li><li>Server executes handler, updates count</li><li>Server sends <code>{ type: &quot;update&quot;, state: { count: 1 } }</code></li><li>Client re-renders with new count</li></ol><h2 id="comparison" tabindex="-1">Comparison <a class="header-anchor" href="#comparison" aria-label="Permalink to &quot;Comparison&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Feature</th><th>Vanilla</th><th>Server-Driven</th></tr></thead><tbody><tr><td>State location</td><td>Client</td><td>Server</td></tr><tr><td>Events</td><td>Local execution</td><td>WebSocket</td></tr><tr><td>Real-time sync</td><td>No</td><td>Yes</td></tr><tr><td>Complexity</td><td>Lower</td><td>Higher</td></tr><tr><td>Dependencies</td><td>None</td><td>WebSocket</td></tr></tbody></table><h2 id="use-cases" tabindex="-1">Use Cases <a class="header-anchor" href="#use-cases" aria-label="Permalink to &quot;Use Cases&quot;">​</a></h2><h3 id="chat-application" tabindex="-1">Chat Application <a class="header-anchor" href="#chat-application" aria-label="Permalink to &quot;Chat Application&quot;">​</a></h3><div class="language-hjx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">hjx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>component Chat</span></span>
<span class="line"><span></span></span>
<span class="line"><span>state:</span></span>
<span class="line"><span>  messages = []</span></span>
<span class="line"><span></span></span>
<span class="line"><span>layout:</span></span>
<span class="line"><span>  view.chat:</span></span>
<span class="line"><span>    for (msg in messages):</span></span>
<span class="line"><span>      view.message: &quot;{{msg.text}}&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>handlers:</span></span>
<span class="line"><span>  sendMessage:</span></span>
<span class="line"><span>    set messages = messages + [inputText]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="live-dashboard" tabindex="-1">Live Dashboard <a class="header-anchor" href="#live-dashboard" aria-label="Permalink to &quot;Live Dashboard&quot;">​</a></h3><p>Multiple clients viewing the same dashboard see real-time updates.</p><h3 id="collaborative-editing" tabindex="-1">Collaborative Editing <a class="header-anchor" href="#collaborative-editing" aria-label="Permalink to &quot;Collaborative Editing&quot;">​</a></h3><p>Multiple users editing the same document see each other&#39;s changes.</p><h2 id="performance-considerations" tabindex="-1">Performance Considerations <a class="header-anchor" href="#performance-considerations" aria-label="Permalink to &quot;Performance Considerations&quot;">​</a></h2><ul><li>WebSocket overhead for each event</li><li>Server must maintain state for each session</li><li>Consider vanilla mode for simple, client-only apps</li></ul><h2 id="security" tabindex="-1">Security <a class="header-anchor" href="#security" aria-label="Permalink to &quot;Security&quot;">​</a></h2><p>The server executes handlers from client events. Ensure:</p><ul><li>Validate all input</li><li>Sanitize data before storage</li><li>Use authentication if needed</li></ul>`,39)])])}const k=e(t,[["render",l]]);export{u as __pageData,k as default};
